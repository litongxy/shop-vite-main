import { getColor, codeToRGB } from '../../util/color.js';
import chartToken from './chartToken.js';

/**
 * Copyright (c) 2024 - present OpenTiny HUICharts Authors.
 * Copyright (c) 2024 - present Huawei Cloud Computing Technologies Co., Ltd.
 *
 * Use of this source code is governed by an MIT-style license.
 *
 * THE OPEN SOURCE SOFTWARE IN THIS PRODUCT IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL,
 * BUT WITHOUT ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS FOR
 * A PARTICULAR PURPOSE. SEE THE APPLICABLE LICENSES FOR MORE DETAILS.
 *
 */

function handleColor(params, baseOption) {
  // 处理depth=1的数据
  handleDepthFirst(params, baseOption);
  // 处理depth>=2的数据
  handleDepthMore(params, baseOption);
}
var handleDepthFirst = function handleDepthFirst(params, baseOption) {
  var depthFirst = params.depthFirst,
    type = params.type;
  var hasRecord = []; // 已记录过的类型
  baseOption.legend.data = [];
  depthFirst.forEach(function (item) {
    if (!baseOption.legend.data.includes(item.type)) {
      var typeColor = getColor(params.color, hasRecord.length);
      baseOption.legend.data.push(item.type);
      hasRecord.push({
        type: item.type,
        color: typeColor
      });
      item.color = typeColor;
      item.borderColor = typeColor;
      if (type === 'nested') {
        item.color = codeToRGB(typeColor, .2);
      }
    } else {
      hasRecord.forEach(function (record) {
        if (record.type === item.type) {
          item.color = record.color;
        }
      });
    }
  });
};
var handleDepthMore = function handleDepthMore(params, baseOption) {
  var depthMore = params.depthMore,
    depthFirst = params.depthFirst;
  baseOption.dataset[0].source.forEach(function (item) {
    item.textColor = chartToken.labelColor;
  });
  if (depthMore && depthMore.length) {
    depthMore.forEach(function (item) {
      depthFirst.forEach(function (parent) {
        if (parent.id === item.id.substring(0, item.id.lastIndexOf('.'))) {
          item.color = codeToRGB(parent.borderColor, .2);
          item.borderColor = parent.borderColor;
        }
      });
    });
  }
};
export { handleColor };
