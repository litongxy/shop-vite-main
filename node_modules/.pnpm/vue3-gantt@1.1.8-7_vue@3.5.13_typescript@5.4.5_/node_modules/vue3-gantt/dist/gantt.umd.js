!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("html2canvas"),require("lay-excel"),require("@ctrl/tinycolor")):"function"==typeof define&&define.amd?define(["exports","vue","html2canvas","lay-excel","@ctrl/tinycolor"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Gantt={},e.Vue,e.html2canvas,e["lay-excel"],e["@ctrl/tinycolor"])}(this,(function(e,t,r,n,a){"use strict";var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var c=function(){this.__data__=[],this.size=0};var l=function(e,t){return e===t||e!=e&&t!=t},i=l;var s=function(e,t){for(var r=e.length;r--;)if(i(e[r][0],t))return r;return-1},u=s,d=Array.prototype.splice;var f=s;var p=s;var y=s;var h=c,v=function(e){var t=this.__data__,r=u(t,e);return!(r<0)&&(r==t.length-1?t.pop():d.call(t,r,1),--this.size,!0)},g=function(e){var t=this.__data__,r=f(t,e);return r<0?void 0:t[r][1]},m=function(e){return p(this.__data__,e)>-1},b=function(e,t){var r=this.__data__,n=y(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function j(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}j.prototype.clear=h,j.prototype.delete=v,j.prototype.get=g,j.prototype.has=m,j.prototype.set=b;var w=j,_=w;var x=function(){this.__data__=new _,this.size=0};var k=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var S=function(e){return this.__data__.get(e)};var E=function(e){return this.__data__.has(e)},O="object"==typeof o&&o&&o.Object===Object&&o,$=O,A="object"==typeof self&&self&&self.Object===Object&&self,C=$||A||Function("return this")(),T=C.Symbol,D=T,F=Object.prototype,N=F.hasOwnProperty,B=F.toString,M=D?D.toStringTag:void 0;var z=function(e){var t=N.call(e,M),r=e[M];try{e[M]=void 0;var n=!0}catch(o){}var a=B.call(e);return n&&(t?e[M]=r:delete e[M]),a},I=Object.prototype.toString;var W=z,P=function(e){return I.call(e)},R=T?T.toStringTag:void 0;var V=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":R&&R in Object(e)?W(e):P(e)};var L=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},U=V,q=L;var H,Y=function(e){if(!q(e))return!1;var t=U(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},G=C["__core-js_shared__"],Z=(H=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"";var J=function(e){return!!Z&&Z in e},X=Function.prototype.toString;var K=function(e){if(null!=e){try{return X.call(e)}catch(t){}try{return e+""}catch(t){}}return""},Q=Y,ee=J,te=L,re=K,ne=/^\[object .+?Constructor\]$/,ae=Function.prototype,oe=Object.prototype,ce=ae.toString,le=oe.hasOwnProperty,ie=RegExp("^"+ce.call(le).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var se=function(e){return!(!te(e)||ee(e))&&(Q(e)?ie:ne).test(re(e))},ue=function(e,t){return null==e?void 0:e[t]};var de=function(e,t){var r=ue(e,t);return se(r)?r:void 0},fe=de(C,"Map"),pe=de(Object,"create"),ye=pe;var he=function(){this.__data__=ye?ye(null):{},this.size=0};var ve=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ge=pe,me=Object.prototype.hasOwnProperty;var be=function(e){var t=this.__data__;if(ge){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return me.call(t,e)?t[e]:void 0},je=pe,we=Object.prototype.hasOwnProperty;var _e=pe;var xe=he,ke=ve,Se=be,Ee=function(e){var t=this.__data__;return je?void 0!==t[e]:we.call(t,e)},Oe=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=_e&&void 0===t?"__lodash_hash_undefined__":t,this};function $e(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}$e.prototype.clear=xe,$e.prototype.delete=ke,$e.prototype.get=Se,$e.prototype.has=Ee,$e.prototype.set=Oe;var Ae=$e,Ce=w,Te=fe;var De=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Fe=function(e,t){var r=e.__data__;return De(t)?r["string"==typeof t?"string":"hash"]:r.map},Ne=Fe;var Be=Fe;var Me=Fe;var ze=Fe;var Ie=function(){this.size=0,this.__data__={hash:new Ae,map:new(Te||Ce),string:new Ae}},We=function(e){var t=Ne(this,e).delete(e);return this.size-=t?1:0,t},Pe=function(e){return Be(this,e).get(e)},Re=function(e){return Me(this,e).has(e)},Ve=function(e,t){var r=ze(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Le(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Le.prototype.clear=Ie,Le.prototype.delete=We,Le.prototype.get=Pe,Le.prototype.has=Re,Le.prototype.set=Ve;var Ue=w,qe=fe,He=Le;var Ye=w,Ge=x,Ze=k,Je=S,Xe=E,Ke=function(e,t){var r=this.__data__;if(r instanceof Ue){var n=r.__data__;if(!qe||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new He(n)}return r.set(e,t),this.size=r.size,this};function Qe(e){var t=this.__data__=new Ye(e);this.size=t.size}Qe.prototype.clear=Ge,Qe.prototype.delete=Ze,Qe.prototype.get=Je,Qe.prototype.has=Xe,Qe.prototype.set=Ke;var et=Qe;var tt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},rt=de,nt=function(){try{var e=rt(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();var at=function(e,t,r){"__proto__"==t&&nt?nt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},ot=at,ct=l,lt=Object.prototype.hasOwnProperty;var it=function(e,t,r){var n=e[t];lt.call(e,t)&&ct(n,r)&&(void 0!==r||t in e)||ot(e,t,r)},st=it,ut=at;var dt=function(e,t,r,n){var a=!r;r||(r={});for(var o=-1,c=t.length;++o<c;){var l=t[o],i=n?n(r[l],e[l],l,r,e):void 0;void 0===i&&(i=e[l]),a?ut(r,l,i):st(r,l,i)}return r};var ft=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var pt=function(e){return null!=e&&"object"==typeof e},yt=V,ht=pt;var vt,gt,mt,bt,jt,wt,_t,xt,kt=function(e){return ht(e)&&"[object Arguments]"==yt(e)},St=pt,Et=Object.prototype,Ot=Et.hasOwnProperty,$t=Et.propertyIsEnumerable,At=kt(function(){return arguments}())?kt:function(e){return St(e)&&Ot.call(e,"callee")&&!$t.call(e,"callee")},Ct=At,Tt=Array.isArray,Dt={};vt={get exports(){return Dt},set exports(e){Dt=e}},mt=C,bt=function(){return!1},jt=(gt=Dt)&&!gt.nodeType&&gt,wt=jt&&vt&&!vt.nodeType&&vt,_t=wt&&wt.exports===jt?mt.Buffer:void 0,xt=(_t?_t.isBuffer:void 0)||bt,vt.exports=xt;var Ft=/^(?:0|[1-9]\d*)$/;var Nt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ft.test(e))&&e>-1&&e%1==0&&e<t};var Bt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Mt=V,zt=Bt,It=pt,Wt={};Wt["[object Float32Array]"]=Wt["[object Float64Array]"]=Wt["[object Int8Array]"]=Wt["[object Int16Array]"]=Wt["[object Int32Array]"]=Wt["[object Uint8Array]"]=Wt["[object Uint8ClampedArray]"]=Wt["[object Uint16Array]"]=Wt["[object Uint32Array]"]=!0,Wt["[object Arguments]"]=Wt["[object Array]"]=Wt["[object ArrayBuffer]"]=Wt["[object Boolean]"]=Wt["[object DataView]"]=Wt["[object Date]"]=Wt["[object Error]"]=Wt["[object Function]"]=Wt["[object Map]"]=Wt["[object Number]"]=Wt["[object Object]"]=Wt["[object RegExp]"]=Wt["[object Set]"]=Wt["[object String]"]=Wt["[object WeakMap]"]=!1;var Pt=function(e){return It(e)&&zt(e.length)&&!!Wt[Mt(e)]};var Rt=function(e){return function(t){return e(t)}},Vt={};!function(e,t){var r=O,n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,o=a&&a.exports===n&&r.process,c=function(){try{var e=a&&a.require&&a.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=c}({get exports(){return Vt},set exports(e){Vt=e}},Vt);var Lt=Pt,Ut=Rt,qt=Vt&&Vt.isTypedArray,Ht=qt?Ut(qt):Lt,Yt=ft,Gt=Ct,Zt=Tt,Jt=Dt,Xt=Nt,Kt=Ht,Qt=Object.prototype.hasOwnProperty;var er=function(e,t){var r=Zt(e),n=!r&&Gt(e),a=!r&&!n&&Jt(e),o=!r&&!n&&!a&&Kt(e),c=r||n||a||o,l=c?Yt(e.length,String):[],i=l.length;for(var s in e)!t&&!Qt.call(e,s)||c&&("length"==s||a&&("offset"==s||"parent"==s)||o&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Xt(s,i))||l.push(s);return l},tr=Object.prototype;var rr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||tr)};var nr=function(e,t){return function(r){return e(t(r))}},ar=nr(Object.keys,Object),or=rr,cr=ar,lr=Object.prototype.hasOwnProperty;var ir=Y,sr=Bt;var ur=function(e){return null!=e&&sr(e.length)&&!ir(e)},dr=er,fr=function(e){if(!or(e))return cr(e);var t=[];for(var r in Object(e))lr.call(e,r)&&"constructor"!=r&&t.push(r);return t},pr=ur;var yr=function(e){return pr(e)?dr(e):fr(e)},hr=dt,vr=yr;var gr=function(e,t){return e&&hr(t,vr(t),e)};var mr=L,br=rr,jr=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},wr=Object.prototype.hasOwnProperty;var _r=er,xr=function(e){if(!mr(e))return jr(e);var t=br(e),r=[];for(var n in e)("constructor"!=n||!t&&wr.call(e,n))&&r.push(n);return r},kr=ur;var Sr=function(e){return kr(e)?_r(e,!0):xr(e)},Er=dt,Or=Sr;var $r=function(e,t){return e&&Er(t,Or(t),e)},Ar={};!function(e,t){var r=C,n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,o=a&&a.exports===n?r.Buffer:void 0,c=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=c?c(r):new e.constructor(r);return e.copy(n),n}}({get exports(){return Ar},set exports(e){Ar=e}},Ar);var Cr=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};var Tr=function(){return[]},Dr=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,o=[];++r<n;){var c=e[r];t(c,r,e)&&(o[a++]=c)}return o},Fr=Tr,Nr=Object.prototype.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,Mr=Br?function(e){return null==e?[]:(e=Object(e),Dr(Br(e),(function(t){return Nr.call(e,t)})))}:Fr,zr=dt,Ir=Mr;var Wr=function(e,t){return zr(e,Ir(e),t)};var Pr=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},Rr=nr(Object.getPrototypeOf,Object),Vr=Pr,Lr=Rr,Ur=Mr,qr=Tr,Hr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Vr(t,Ur(e)),e=Lr(e);return t}:qr,Yr=dt,Gr=Hr;var Zr=function(e,t){return Yr(e,Gr(e),t)},Jr=Pr,Xr=Tt;var Kr=function(e,t,r){var n=t(e);return Xr(e)?n:Jr(n,r(e))},Qr=Kr,en=Mr,tn=yr;var rn=function(e){return Qr(e,tn,en)},nn=Kr,an=Hr,on=Sr;var cn=function(e){return nn(e,on,an)},ln=de(C,"DataView"),sn=fe,un=de(C,"Promise"),dn=de(C,"Set"),fn=de(C,"WeakMap"),pn=V,yn=K,hn="[object Map]",vn="[object Promise]",gn="[object Set]",mn="[object WeakMap]",bn="[object DataView]",jn=yn(ln),wn=yn(sn),_n=yn(un),xn=yn(dn),kn=yn(fn),Sn=pn;(ln&&Sn(new ln(new ArrayBuffer(1)))!=bn||sn&&Sn(new sn)!=hn||un&&Sn(un.resolve())!=vn||dn&&Sn(new dn)!=gn||fn&&Sn(new fn)!=mn)&&(Sn=function(e){var t=pn(e),r="[object Object]"==t?e.constructor:void 0,n=r?yn(r):"";if(n)switch(n){case jn:return bn;case wn:return hn;case _n:return vn;case xn:return gn;case kn:return mn}return t});var En=Sn,On=Object.prototype.hasOwnProperty;var $n=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&On.call(e,"index")&&(r.index=e.index,r.input=e.input),r},An=C.Uint8Array;var Cn=function(e){var t=new e.constructor(e.byteLength);return new An(t).set(new An(e)),t},Tn=Cn;var Dn=function(e,t){var r=t?Tn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},Fn=/\w*$/;var Nn=function(e){var t=new e.constructor(e.source,Fn.exec(e));return t.lastIndex=e.lastIndex,t},Bn=T?T.prototype:void 0,Mn=Bn?Bn.valueOf:void 0;var zn=Cn;var In=Cn,Wn=Dn,Pn=Nn,Rn=function(e){return Mn?Object(Mn.call(e)):{}},Vn=function(e,t){var r=t?zn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Ln=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return In(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Wn(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Vn(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Pn(e);case"[object Symbol]":return Rn(e)}},Un=L,qn=Object.create,Hn=function(){function e(){}return function(t){if(!Un(t))return{};if(qn)return qn(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Yn=Rr,Gn=rr;var Zn=function(e){return"function"!=typeof e.constructor||Gn(e)?{}:Hn(Yn(e))},Jn=En,Xn=pt;var Kn=function(e){return Xn(e)&&"[object Map]"==Jn(e)},Qn=Rt,ea=Vt&&Vt.isMap,ta=ea?Qn(ea):Kn,ra=En,na=pt;var aa=function(e){return na(e)&&"[object Set]"==ra(e)},oa=Rt,ca=Vt&&Vt.isSet,la=ca?oa(ca):aa,ia=et,sa=tt,ua=it,da=gr,fa=$r,pa=Ar,ya=Cr,ha=Wr,va=Zr,ga=rn,ma=cn,ba=En,ja=$n,wa=Ln,_a=Zn,xa=Tt,ka=Dt,Sa=ta,Ea=L,Oa=la,$a=yr,Aa=Sr,Ca="[object Arguments]",Ta="[object Function]",Da="[object Object]",Fa={};Fa[Ca]=Fa["[object Array]"]=Fa["[object ArrayBuffer]"]=Fa["[object DataView]"]=Fa["[object Boolean]"]=Fa["[object Date]"]=Fa["[object Float32Array]"]=Fa["[object Float64Array]"]=Fa["[object Int8Array]"]=Fa["[object Int16Array]"]=Fa["[object Int32Array]"]=Fa["[object Map]"]=Fa["[object Number]"]=Fa[Da]=Fa["[object RegExp]"]=Fa["[object Set]"]=Fa["[object String]"]=Fa["[object Symbol]"]=Fa["[object Uint8Array]"]=Fa["[object Uint8ClampedArray]"]=Fa["[object Uint16Array]"]=Fa["[object Uint32Array]"]=!0,Fa["[object Error]"]=Fa[Ta]=Fa["[object WeakMap]"]=!1;var Na=function e(t,r,n,a,o,c){var l,i=1&r,s=2&r,u=4&r;if(n&&(l=o?n(t,a,o,c):n(t)),void 0!==l)return l;if(!Ea(t))return t;var d=xa(t);if(d){if(l=ja(t),!i)return ya(t,l)}else{var f=ba(t),p=f==Ta||"[object GeneratorFunction]"==f;if(ka(t))return pa(t,i);if(f==Da||f==Ca||p&&!o){if(l=s||p?{}:_a(t),!i)return s?va(t,fa(l,t)):ha(t,da(l,t))}else{if(!Fa[f])return o?t:{};l=wa(t,f,i)}}c||(c=new ia);var y=c.get(t);if(y)return y;c.set(t,l),Oa(t)?t.forEach((function(a){l.add(e(a,r,n,a,t,c))})):Sa(t)&&t.forEach((function(a,o){l.set(o,e(a,r,n,o,t,c))}));var h=d?void 0:(u?s?ma:ga:s?Aa:$a)(t);return sa(h||t,(function(a,o){h&&(a=t[o=a]),ua(l,o,e(a,r,n,o,t,c))})),l},Ba=Na;var Ma=function(e){return Ba(e,5)};const za=(e,t=null)=>{let r=e;return"string"==typeof t&&(r=Pa(e,t)),r.map((e=>Ia(e)))},Ia=e=>{let t=null;"string"==typeof e?t=new Date(e):e instanceof Date&&(t=e);return{year:String(t.getFullYear()).padStart(4,"0"),month:String(t.getMonth()+1).padStart(2,"0"),day:String(t.getDate()).padStart(2,"0"),week:["日","一","二","三","四","五","六"][t.getDay()]}},Wa=e=>{const t=e.replace(/\//g,"-").split("-").map((e=>Number(e)));if(2!==t.length)throw new Error("获取月份日期参数错误:",e);const r=new Date(...t,0).getDate();return new Array(r).fill().map(((e,t)=>t+1))},Pa=(e,t)=>{const r=new Date(e.replace(/\//g,"-")),n=new Date(t);r.setHours(0,0,0,0);const a=[];for(;n.getTime()>=r.getTime();){const e=Ia(r);a.push(`${e.year}-${e.month}-${e.day}`),r.setDate(r.getDate()+1)}return a},Ra=e=>{const t={};return e.forEach((e=>{const r=e.year+"-"+e.month;t[r]?t[r].push(e):t[r]=[e]})),Object.values(t)},Va=(e,t)=>Pa(...t).includes(e),La=e=>{const t=String(e).replace("/","-").split("-");return Wa(e).map((e=>String(t[0]).padStart(4,"0")+"-"+String(t[1]).padStart(2,"0")+"-"+String(e).padStart(2,"0")))},Ua=()=>{const e=new Date;return`${String(e.getFullYear()).padStart(4,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},qa=(e=new Date)=>{const t=e.getFullYear(),r=e.getMonth()+1,n=`${t}-${String(r).padStart(2,"0")}`;let a="";a=1===r?`${String(t-1).padStart(4,"0")}-12`:`${String(t).padStart(4,"0")}-${String(r-1).padStart(2,"0")}`;let o="";o=12===r?`${String(t+1).padStart(4,"0")}-01`:`${String(t).padStart(4,"0")}-${String(r+1).padStart(2,"0")}`;const c=La(a),l=La(n),i=La(o);let s=[...c,...l,...i];return s.prev=c,s.current=l,s.next=i,s},Ha=(e,t)=>e.map((e=>{if("normal"!==e.type)return e;const r=(e=>{if(!e.length)return{};const t=e[0].days[0],r=e.map((e=>new Date(e.days.at(-1)).getTime())).sort(((e,t)=>e-t)).at(-1),n=Ia(new Date(r)),a=`${n.year}-${n.month}-${n.day}`,o={};return Pa(t,a).forEach((t=>{const r=e.map(((e,r)=>!!e.days.includes(t)&&r)).filter((e=>!1!==e));r.length&&(o[t]=r)})),o})(e.schedule),n=Object.values(r),a=Object.keys(r);if(!a.length)return e;const o=[];for(let t=0;t<n.length;t++)JSON.stringify(o.at(-1))!==JSON.stringify(n[t])?(o.push(n[t]),o.at(-1).days=[a[t]]):o.at(-1)&&(o.at(-1).days?o.at(-1).days.push(a[t]):o.at(-1).days=[a[t]]);let c=new Array(o.length).fill({});return c=c.map(((r,n)=>{let a={};if(1===o[n].length){if(a={...e.schedule[o[n][0]],days:o[n].days,daysSource:e.schedule[o[n][0]].days},a.list){let e="",r="";e="function"==typeof t.desc?t.desc(a.list):t.desc,r="function"==typeof t.name?t.name(a.list):t.name,a={...a,desc:e,name:r,backgroundColor:t.backgroundColor,textColor:t.textColor}}}else{const r=o[n].map((t=>e.schedule[t]));let c="",l="";c="function"==typeof t.desc?t.desc(r):t.desc,l="function"==typeof t.name?t.name(r):t.name,a={desc:c,backgroundColor:t.backgroundColor,textColor:t.textColor,name:l,list:r,days:o[n].days}}return a})),e.schedule=c,e}));var Ya=function(e){var t=0,r=e.match(/./g),n=0,a=e.length-1;for(n=1;a>=0;a--,n*=26){var o=r[a].toUpperCase();if(o<"A"||o>"Z")return 0;t+=(o.charCodeAt(0)-64)*n}return t},Ga=function(e){for(var t="";e>0;){var r=e%26;0==r&&(r=26),t=String.fromCharCode(r+64)+t,e=(e-r)/26}return t};const Za=e=>new a.TinyColor(e).toHexString().substring(1);const Ja={class:"guide"},Xa={class:"desc"},Ka={class:"date"},Qa={class:"item"},eo={class:"item-name-list"},to={class:"date-list first-date-list"},ro={class:"month"},no={class:"day-box"},ao={class:"day"},oo={class:"week"},co={class:"schedule-box"},lo=["title","onMousemove","onMouseout","onClick"],io={key:0,class:"work-desc"},so=((e,t)=>{const r=e.__vccOpts||e;for(const[n,a]of t)r[n]=a;return r})({__name:"Gantt",props:{data:{type:Array,required:!0,default:[]},dateRangeList:{type:Array,required:!0,default:[],validator:e=>e[0]&&e.at(-1)},dateText:{type:String,required:!0},itemText:{type:String,required:!0},activeDate:{type:String,default:()=>Ua()},repeatMode:{type:Object,default:()=>({mode:"cover",backgroundColor:"#FFFFCC",textColor:"#336666",name:"重叠日程",desc:"这是多个日程"})},itemWidth:{type:Number,default:40,validator:e=>e>=40},itemHeight:{type:Number,default:40,validator:e=>e>=40},scheduleTitle:{type:Function,default:null},borderColor:{type:String,default:"#eee"},alikeName:{type:Function,default:null}},emits:["scheduleClick","scrollXEnd","scrollYEnd"],setup(e,{expose:a,emit:o}){const c=e;t.useCssVars((e=>({a5e82f3c:c.borderColor,"7527dfcf":c.itemWidth+"px","7a5c76be":c.itemHeight+"px",32661602:i.value,"285d8fc0":s.value})));let l=t.ref([]);const i=t.ref("2000px"),s=t.ref("0px"),u=t.ref();let d=null;const f=()=>{clearTimeout(d),d=setTimeout((()=>{u.value&&(s.value=0,t.nextTick((()=>{const e=u.value.parentElement||document.body,t=u.value.querySelector(".desc").getBoundingClientRect(),r=e.getBoundingClientRect(),n=t.top-r.top;s.value=r.height-t.height-n+"px"})))}),200)};t.onMounted((()=>{const e=u.value.querySelector(".item-name-list"),t=u.value.querySelector(".schedule-box");e.addEventListener("scroll",k),t.addEventListener("scroll",k),window.addEventListener("resize",f),f()})),t.watchEffect((()=>{l.value=Ra(za(c.dateRangeList[0],c.dateRangeList.at(-1))),console.log("rangeDate.value",l.value),i.value=c.itemWidth*l.value.flat(1).length+122+"px"}));const p=t.ref([]),y=e=>e.map((e=>("normal"===e.type&&Array.isArray(e.schedule)&&e.schedule.length&&(e.schedule=e.schedule.filter((e=>{const t=l.value[0][0],r=`${t.year}-${t.month}-${t.day}`;return new Date(e.days.at(-1)).getTime()>=new Date(r).getTime()}))),e))),h=()=>{(()=>{const e=["type","name","schedule"],t=["id","name","desc","backgroundColor","textColor","days"];c.data.forEach((r=>{if("normal"===r.type){const n=Object.keys(r),a=e.find((e=>!n.includes(e)));if(a)throw new Error(`项目缺少${a}项`);r.schedule.forEach((e=>{if(!e.list){const r=Object.keys(e),n=t.find((e=>!r.includes(e)));if(n)throw new Error(`日程缺少${n}项`)}}))}}))})(),p.value=Ma(c.data).map((e=>"normal"===e.type&&Array.isArray(e.schedule)?(e.schedule=e.schedule.sort(((e,t)=>new Date(e.days[0]).getTime()-new Date(t.days[0]).getTime())),e.schedule=e.schedule.map((e=>(2===e.days.length&&(e.days=Pa(...e.days)),e))),e):e)),p.value=y(p.value)},v=(e,t)=>{let r={};return"alike"===e.type&&(r={...r,backgroundColor:e.color}),t&&"works"===t.type&&(r={...r,backgroundColor:t.backgroundColor,color:t.textColor,width:t.width+"px",marginLeft:-t.left+"px"}),r},g=(e,t)=>{const r=Va(e[0],[t[0].date,t[t.length-1].date]),n=Va(e[e.length-1],[t[0].date,t[t.length-1].date]);if(r&&n)return e.length*c.itemWidth;if(!r&&n)return Pa(t[0].date,e[e.length-1]).length*c.itemWidth;if(r&&!n)return Pa(e[0],t[t.length-1].date).length*c.itemWidth;if(!r&&!n)return Pa(t[0].date,t.at(-1).date).length*c.itemWidth;throw new Error("computeWordwidth 宽度计算异常！")},m=(e,t)=>e.days.filter((e=>t.days.includes(e))),b=(e,t)=>t.find((t=>"works"===t.type&&t.days.includes(e))),j=(e,t)=>{const r=b(e.days[0],t);if(r&&e.id!==r.id){const n=m(r,e),a=e.days.slice(n.length)[0],o=t.findIndex((e=>e.date===a));t[o]={type:"works",date:e.days[0],width:g(e.days,t),left:n.length*c.itemWidth,...e}}else{const r=t.findIndex((t=>t.date===e.days[0]));t[r]={type:"works",date:e.days[0],width:g(e.days,t),left:0,...e}}return t=t.filter((t=>!("normal"===t.type&&e.days.includes(t.date))))},w=e=>{const t=(e=>e.flat(1).map((e=>({type:"normal",date:String(e.year).padStart(4,"0")+"-"+String(e.month).padStart(2,"0")+"-"+String(e.day).padStart(2,"0")}))))(l.value);if(!e.schedule||!e.schedule.length)return t;let r=[];return e.schedule.forEach((e=>{t.forEach((n=>{const a=(o=n.date,e.days.includes(o));var o;const c=((e,t)=>!!t.find((t=>t.date===e)))(n.date,r),l=((e,t)=>!!((e,t)=>!!t.find((t=>t.days.includes(e))))(e,t.filter((e=>"works"===e.type))))(n.date,r);if(a)if(c||l)if(!c&&l){const t=b(n.date,r);e.id!==t.id&&(m(t,e),r=j(e,r))}else c&&!l&&(console.warn("当前日期已经被添加 && 当前日程不在已添加的日程范围内 (新增日程)"),r=j(e,r));else r.push({type:"works",date:n.date,width:g(e.days,t),left:0,...e});else c||l||r.push(n)}))})),r};let _=null;const x=t.ref(null),k=e=>{const t=e?e.target:x.value;if(!t)return;let r="item-name-list";"item-name-list"===t.className&&(r="schedule-box");const n=u.value.querySelector(`.${r}`);n&&(n.scrollTop=t.scrollTop),_&&clearTimeout(_),_=setTimeout((()=>{const r=Math.ceil(Math.max(t.clientHeight,t.scrollHeight));t.scrollTop+t.clientHeight>=r&&o("scrollYEnd",e)}),200)};t.watchEffect((()=>{h(),"extract"===c.repeatMode.mode&&(p.value=Ha(p.value,c.repeatMode),p.value=y(p.value)),t.nextTick((()=>{k()}))}));return a({exportImg:async(e={})=>{if("boolean"==typeof e||"object"!=typeof e)throw new Error("exportImg传参方式已更改，请通过Object方式设置导出配置");let{download:n=!0,waterType:a="txt",waterValue:o=""}=e;return new Promise((e=>{const a=document.querySelector(".guide");s.value="unset",u.value.style.maxWidth="unset",x.value.scrollLeft=x.value.scrollWidth,u.value.style.width=x.value.scrollWidth+a.clientWidth+"px",t.nextTick((()=>{o=o.trim();let t=null;if(o){const e=(e=>{let t=20*e.length,r=document.createElement("canvas");r.width=r.height=t;let n=r.getContext("2d");n.font='14px "PingFangSC", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif',n.fillStyle="rgba(0,0,0,0.5)",n.rotate(-25*Math.PI/180),n.fillText(e,t/20,t/2);const a=r.toDataURL("image/png");return r=n=null,a})(o);t=document.createElement("div"),t.style.position="absolute",t.style.zIndex="9999",t.style.opacity="0.1",t.style.top=t.style.left="0",t.style.width=t.style.height="100%",t.style.backgroundImage=`url(${e})`,u.value.appendChild(t)}r(u.value,{removeContainer:!0}).then((function(r){const a=r.toDataURL();if(t&&t.parentNode.removeChild(t),u.value.style.maxWidth=i.value,f(),u.value.style.width="100%",n){const e=document.createElement("a");e.href=a,e.setAttribute("download","日程图"),e.click()}e(a)}))}))}))},exportGanttExcel:e=>{const t=Ma(p.value).map((e=>(e.renderWorks=w(e),"alike"===e.type&&c.alikeName&&(e.name=c.alikeName(e)),"normal"===e.type&&c.scheduleTitle&&e.renderWorks.forEach((e=>{e.name=c.scheduleTitle(e)})),e)));!function(e,t,r,a="",o=""){const{fileName:c="数据"}=e;console.log("导出excel",t,r);let l=[];const i=[{name:`${a}-${o}`},{},{}],s=["name"];let u=[];const d={name:""};t.forEach((e=>{e.forEach((e=>{i[0][`${e.year}-${e.month}-${e.day}`]=`${e.year}-${e.month}`,i[1][`${e.year}-${e.month}-${e.day}`]=e.day,i[2][`${e.year}-${e.month}-${e.day}`]=e.week,s.push(`${e.year}-${e.month}-${e.day}`),d[`${e.year}-${e.month}-${e.day}`]=""}));const t=u.at(-1)?Ga(Ya(u.at(-1).at(-1))):"A",r=Ga(Ya(t)+e.length);u.push([Ga(Ya(t)+1),r])})),u=u.map((e=>e.map((e=>e+1)))),l=l.concat(i);const f=s.length-1;r.forEach((e=>{const t=JSON.parse(JSON.stringify(d));t.name=e.name,t.type=e.type,t.renderWorks=e.renderWorks,l.push(t)}));const p=[],y=[];l.forEach(((e,t)=>{const r=t+1;"alike"===e.type?(p.push([`B${r}`,`${Ga(f+1)}${r}`]),y.push({type:1,backgroundColor:"F6F6F6",range:`A${r}:${Ga(f+1)}${r}`})):e.renderWorks&&e.renderWorks.forEach((e=>{if("works"===e.type){const t=s.findIndex((t=>t===e.days[0])),n=Ga((t<1?1:t)+1),a=s.findIndex((t=>t===e.days.at(-1))),o=Ga((a<1?s.length-1:a)+1);p.push([`${n}${r}`,`${o}${r}`]),y.push({type:1,backgroundColor:e.backgroundColor.replace("#",""),textColor:e.textColor.replace("#",""),range:`${n}${r}:${o}${r}`}),e.days.forEach((t=>{l[r-1][t]=e.name}))}}))}));const h=[["A1","A3"],...u,...p],v=n.filterExportData(l,s),g=n.makeMergeConfig(h),m=n.makeColConfig({A:120,ZZZZ:60},60),b=n.makeRowConfig({1:40,99999:40},40);n.setExportCellStyle(v,null,{s:{alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin",color:{rgb:"E2E4E8"}},left:{style:"thin",color:{rgb:"E2E4E8"}},right:{style:"thin",color:{rgb:"E2E4E8"}},bottom:{style:"thin",color:{rgb:"E2E4E8"}}}}}),y.forEach((e=>{1===e.type&&n.setExportCellStyle(v,e.range,{s:{fill:{bgColor:{indexed:64},fgColor:{rgb:Za(e.backgroundColor||"FFFFFF")}},font:{color:{rgb:Za(e.textColor||"000000")}},border:{top:{style:"thin",color:{rgb:"E2E4E8"}},left:{style:"thin",color:{rgb:"E2E4E8"}},right:{style:"thin",color:{rgb:"E2E4E8"}},bottom:{style:"thin",color:{rgb:"E2E4E8"}}},alignment:{horizontal:"center",vertical:"center",wrapText:!0}}})})),n.exportExcel({sheet1:v},`${c}.xlsx`,"xlsx",{extend:{"!cols":m,"!rows":b,"!merges":g}})}(e,l.value,t,c.dateText,c.itemText)}}),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:"gantt",ref_key:"gantt",ref:u},[t.createElementVNode("div",Ja,[t.createElementVNode("div",Xa,[t.createElementVNode("span",Ka,t.toDisplayString(c.dateText),1),t.createElementVNode("span",Qa,t.toDisplayString(c.itemText),1)]),t.createElementVNode("div",eo,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,((e,r)=>(t.openBlock(),t.createElementBlock("div",{key:r,class:t.normalizeClass({"guide-name":!0,"last-guide-name":r===p.value.length-1}),style:t.normalizeStyle("alike"===e.type&&v(e))},t.toDisplayString("function"==typeof c.alikeName&&"alike"===e.type?c.alikeName(e):e.name),7)))),128))])]),t.createElementVNode("div",{class:"inner",onScroll:r[0]||(r[0]=e=>{return t=e,_&&clearTimeout(_),void(_=setTimeout((()=>{const e=t.target,r=Math.ceil(Math.max(e.clientWidth,e.scrollWidth));e.scrollLeft+e.clientWidth>=r&&o("scrollXEnd",t)}),200));var t}),ref_key:"innerRef",ref:x},[t.createElementVNode("div",to,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l),(e=>(t.openBlock(),t.createElementBlock("div",{key:e.year+"-"+e.month,class:"month-item"},[t.createElementVNode("div",ro,t.toDisplayString(e[0].year+"-"+e[0].month),1),t.createElementVNode("div",no,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e,((e,r)=>(t.openBlock(),t.createElementBlock("div",{key:e.day+e.week,class:t.normalizeClass({"day-item":!0,"first-day-item":0===r,"date-active":c.activeDate===e.year+"-"+e.month+"-"+e.day})},[t.createElementVNode("div",ao,t.toDisplayString(e.day),1),t.createElementVNode("div",oo,t.toDisplayString(e.week),1)],2)))),128))])])))),128))]),t.createElementVNode("div",co,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,((e,r)=>(t.openBlock(),t.createElementBlock("div",{key:r,class:t.normalizeClass({"date-box":!0,alike:"alike"===e.type})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(w(e),((r,n)=>(t.openBlock(),t.createElementBlock("div",{key:n,class:t.normalizeClass({"date-item":!0,"date-item-work":"works"===r.type,"date-active":r.date===c.activeDate}),style:t.normalizeStyle(v(e,r)),title:"works"===r.type?r.desc:"",onMousemove:e=>((e,t)=>{"works"===e&&("SPAN"===t.target.tagName?(t.target.parentElement.style.zIndex=2,t.target.parentElement.style.boxShadow="0 0 5px 0px rgba(0, 0, 0, 0.2)"):(t.target.style.zIndex=2,t.target.style.boxShadow="0 0 5px 0px rgba(0, 0, 0, 0.2)"))})(r.type,e),onMouseout:e=>((e,t)=>{"works"===e&&("SPAN"===t.target.tagName?(t.target.parentElement.style.zIndex=1,t.target.parentElement.style.boxShadow="none"):(t.target.style.zIndex=1,t.target.style.boxShadow="none"))})(r.type,e),onClick:e=>(e=>{o("scheduleClick",e)})({...r,event:e})},["works"===r.type?(t.openBlock(),t.createElementBlock("span",io,t.toDisplayString(c.scheduleTitle?c.scheduleTitle(r):r.name),1)):t.createCommentVNode("",!0)],46,lo)))),128))],2)))),128))])],544)],512))}},[["__scopeId","data-v-b9f77374"]]);e.computedDaysRange=za,e.default=so,e.fetchDayDetail=Ia,e.fetchMonthRangeDay=La,e.fetchNextMonthRange=(e=new Date)=>qa(e).next,e.fetchPrevMonthRange=(e=new Date)=>qa(e).prev,e.fetchThreeDays=qa,e.fetchToday=Ua,e.fetchTodayMonthRange=(e=new Date)=>qa(e).current,e.fethDays=Wa,e.fethDaysRange=Pa,e.splitDaysForMonth=Ra,e.todayInRange=Va,e.workListSplitForRepeat=Ha,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=gantt.umd.js.map
