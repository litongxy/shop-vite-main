{"version":3,"file":"index.cjs.js","sources":["../../../src/format-painter/index.ts"],"sourcesContent":["import type { Range } from 'quill'\r\nimport type Toolbar from 'quill/modules/toolbar'\r\nimport Quill from 'quill'\r\n\r\ninterface FormatData {\r\n  formatPainter: {\r\n    rangeFormat: Record<string, any>\r\n    isFormatterLock: boolean\r\n    isFormating: boolean\r\n    prepareLock: boolean\r\n  }\r\n}\r\nexport function FormatPainter(this: Toolbar & FormatData) {\r\n  if (!this.formatPainter) {\r\n    this.formatPainter = {\r\n      rangeFormat: {},\r\n      isFormatterLock: false,\r\n      isFormating: false,\r\n      prepareLock: false,\r\n    }\r\n  }\r\n  const [, formatterBtn] = this.controls.find(([name]) => name === FormatPainter.toolName)\r\n  const formatRange = (range: Range | null) => {\r\n    if (!range) return\r\n    this.quill.removeFormat(range.index, range.length)\r\n    for (const format in this.formatPainter.rangeFormat) {\r\n      this.quill.format(format, this.formatPainter.rangeFormat[format], Quill.sources.USER)\r\n    }\r\n    if (!this.formatPainter.isFormatterLock) {\r\n      unbindFormatSelect()\r\n    }\r\n    else {\r\n      btnActive()\r\n    }\r\n  }\r\n  // setTime for Toolbar.update\r\n  const btnActive = () => {\r\n    setTimeout(() => {\r\n      formatterBtn.classList.add('ql-active')\r\n    }, 0)\r\n  }\r\n  const btnRemoveActive = () => {\r\n    setTimeout(() => {\r\n      formatterBtn.classList.remove('ql-active')\r\n    }, 0)\r\n  }\r\n  const bindFormatSelect = () => {\r\n    const range = this.quill.getSelection()\r\n    if (range.length === 0) return\r\n    this.formatPainter.rangeFormat = this.quill.getFormat(range)\r\n    this.formatPainter.isFormating = true\r\n    this.quill.on(Quill.events.SELECTION_CHANGE, formatRange)\r\n    btnActive()\r\n  }\r\n  const unbindFormatSelect = () => {\r\n    this.quill.off(Quill.events.SELECTION_CHANGE, formatRange)\r\n    this.formatPainter.rangeFormat = undefined\r\n    btnRemoveActive()\r\n    this.formatPainter.isFormating = false\r\n    this.formatPainter.isFormatterLock = false\r\n  }\r\n\r\n  if (this.formatPainter.isFormatterLock || (this.formatPainter.isFormating && !this.formatPainter.prepareLock)) {\r\n    unbindFormatSelect()\r\n  }\r\n  else if (this.formatPainter.isFormating && this.formatPainter.prepareLock) {\r\n    this.formatPainter.isFormatterLock = true\r\n    btnActive()\r\n  }\r\n  else {\r\n    // imitate double click\r\n    this.formatPainter.prepareLock = true\r\n    setTimeout(() => {\r\n      this.formatPainter.prepareLock = false\r\n    }, 200)\r\n    bindFormatSelect()\r\n  }\r\n}\r\nFormatPainter.toolName = 'format-painter'\r\n"],"names":[],"mappings":";;;AAYO,SAAS,gBAA0C;AACpD,MAAA,CAAC,KAAK,eAAe;AACvB,SAAK,gBAAgB;AAAA,MACnB,aAAa,CAAC;AAAA,MACd,iBAAiB;AAAA,MACjB,aAAa;AAAA,MACb,aAAa;AAAA,IAAA;AAAA,EAEjB;AACA,QAAM,GAAG,YAAY,IAAI,KAAK,SAAS,KAAK,CAAC,CAAC,IAAI,MAAM,SAAS,cAAc,QAAQ;AACjF,QAAA,cAAc,CAAC,UAAwB;AAC3C,QAAI,CAAC,MAAO;AACZ,SAAK,MAAM,aAAa,MAAM,OAAO,MAAM,MAAM;AACtC,eAAA,UAAU,KAAK,cAAc,aAAa;AAC9C,WAAA,MAAM,OAAO,QAAQ,KAAK,cAAc,YAAY,MAAM,GAAG,MAAM,QAAQ,IAAI;AAAA,IACtF;AACI,QAAA,CAAC,KAAK,cAAc,iBAAiB;AACpB;IAAA,OAEhB;AACO;IACZ;AAAA,EAAA;AAGF,QAAM,YAAY,MAAM;AACtB,eAAW,MAAM;AACF,mBAAA,UAAU,IAAI,WAAW;AAAA,OACrC,CAAC;AAAA,EAAA;AAEN,QAAM,kBAAkB,MAAM;AAC5B,eAAW,MAAM;AACF,mBAAA,UAAU,OAAO,WAAW;AAAA,OACxC,CAAC;AAAA,EAAA;AAEN,QAAM,mBAAmB,MAAM;AACvB,UAAA,QAAQ,KAAK,MAAM,aAAa;AAClC,QAAA,MAAM,WAAW,EAAG;AACxB,SAAK,cAAc,cAAc,KAAK,MAAM,UAAU,KAAK;AAC3D,SAAK,cAAc,cAAc;AACjC,SAAK,MAAM,GAAG,MAAM,OAAO,kBAAkB,WAAW;AAC9C;EAAA;AAEZ,QAAM,qBAAqB,MAAM;AAC/B,SAAK,MAAM,IAAI,MAAM,OAAO,kBAAkB,WAAW;AACzD,SAAK,cAAc,cAAc;AACjB;AAChB,SAAK,cAAc,cAAc;AACjC,SAAK,cAAc,kBAAkB;AAAA,EAAA;AAGnC,MAAA,KAAK,cAAc,mBAAoB,KAAK,cAAc,eAAe,CAAC,KAAK,cAAc,aAAc;AAC1F;EAAA,WAEZ,KAAK,cAAc,eAAe,KAAK,cAAc,aAAa;AACzE,SAAK,cAAc,kBAAkB;AAC3B;EAAA,OAEP;AAEH,SAAK,cAAc,cAAc;AACjC,eAAW,MAAM;AACf,WAAK,cAAc,cAAc;AAAA,OAChC,GAAG;AACW;EACnB;AACF;AACA,cAAc,WAAW;;"}