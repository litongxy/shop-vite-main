{"version":3,"file":"index.cjs.js","sources":["../../../src/quick-menu/index.ts"],"sourcesContent":["import type Quill from 'quill'\r\n\r\ninterface QuickMenuOptions {\r\n  container: string\r\n  component: any\r\n}\r\n\r\nclass QuickMenu {\r\n  private container: HTMLDivElement\r\n  private hostElement: HTMLDivElement\r\n  private quickMenu: HTMLDivElement\r\n  private quickMenuContainer: HTMLDivElement\r\n\r\n  // @ts-ignore\r\n  constructor(private quill: Quill, private options: QuickMenuOptions) {\r\n    this.quill = quill\r\n    this.options = options\r\n    this.container = this.quill.container\r\n    this.hostElement = this.container.parentNode as HTMLDivElement\r\n    this.quickMenu = this.hostElement.querySelector('.quick-menu')\r\n    this.quickMenuContainer = this.quickMenu.querySelector('.quick-menu-container')\r\n    quill.keyboard.addBinding({ key: '/' }, this.handleSlashKeyDown)\r\n    quill.keyboard.addBinding({ key: 'ArrowUp' }, this.handleArrowUpKey)\r\n    quill.keyboard.addBinding({ key: 'ArrowDown' }, this.handleArrowDownKey)\r\n    quill.keyboard.addBinding({ key: 'Enter' }, this.handleEnterKey)\r\n    quill.keyboard.bindings.Enter.unshift(quill.keyboard.bindings.Enter.pop())\r\n    document.body.addEventListener('click', this.hideQuickMenu.bind(this))\r\n  }\r\n\r\n  handleSlashKeyDown = (_range, context) => {\r\n    const index = this.quill.selection.savedRange.index\r\n    this.quill.insertText(index, '/')\r\n\r\n    // 一行的第一个字符为 '/'，且没有格式化，则触发快捷菜单\r\n    const shouldTriggerQuickMenu = context.prefix === '' && Object.keys(context.format).length === 0\r\n    if (shouldTriggerQuickMenu) {\r\n      const cursorIndex = this.quill.selection.savedRange.index\r\n      const cursorBounds = this.quill.getBounds(cursorIndex)\r\n      const { left, top } = cursorBounds\r\n      const { left: editorLeft, top: editorTop } = this.container.getBoundingClientRect()\r\n      const { left: hostElementLeft, top: hostElementTop } = this.hostElement.getBoundingClientRect()\r\n      const relativeLeft = editorLeft - hostElementLeft\r\n      const relativeTop = editorTop - hostElementTop\r\n      const menuLeft = left + relativeLeft - 5\r\n      const menuTop = top + relativeTop + 20\r\n\r\n      this.quickMenu.style.display = 'block'\r\n      const zIndex = this.quill.options.modules.quickmenu.zIndex\r\n      let style = `left:${menuLeft}px;top:${menuTop}px;`\r\n      if (zIndex || zIndex === 0) {\r\n        style += `z-index:${zIndex}`\r\n      }\r\n      this.quickMenuContainer.setAttribute('style', style)\r\n      this.options.component.activeIndex = 0\r\n    }\r\n    else {\r\n      this.quickMenu.style.display = 'none'\r\n    }\r\n  }\r\n\r\n  private isOpen() {\r\n    return this.quickMenuContainer.style.display !== 'none' && this.quickMenu.style.display === 'block'\r\n  }\r\n\r\n  hideQuickMenu = (event) => {\r\n    if (this.quickMenuContainer && !this.quickMenuContainer.contains(event.target)) {\r\n      this.quickMenuContainer.style.display = 'none'\r\n    }\r\n  }\r\n\r\n  handleArrowUpKey = (_range, _context) => {\r\n    if (this.isOpen()) {\r\n      const index = this.options.component.activeIndex\r\n      const total = this.options.component.quickMenus.length\r\n      this.options.component.activeIndex = (index + total - 1) % total\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n\r\n  handleArrowDownKey = (_range, _context) => {\r\n    if (this.isOpen()) {\r\n      const index = this.options.component.activeIndex\r\n      const total = this.options.component.quickMenus.length\r\n      this.options.component.activeIndex = (index + 1) % total\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n\r\n  handleEnterKey = (_range, _context) => {\r\n    if (this.isOpen()) {\r\n      this.options.component.onEnter()\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n}\r\n\r\nexport default QuickMenu\r\n"],"names":[],"mappings":"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"}