{"version":3,"file":"toolbar-emoji.es.js","sources":["../../../../src/emoji/modules/toolbar-emoji.ts"],"sourcesContent":["import Quill from 'quill'\r\nimport { EMOJI_SPRITE as emojiSprite } from '../../config/base64-image'\r\nimport emojiList from '../emoji-list'\r\n\r\nconst Module = Quill.imports['core/module']\r\n\r\nclass ToolbarEmoji extends Module {\r\n  quill: any\r\n  toolbar: any\r\n  constructor(quill, options) {\r\n    super(quill, options)\r\n\r\n    this.quill = quill\r\n    this.toolbar = quill.getModule('toolbar')\r\n    if (typeof this.toolbar !== 'undefined') {\r\n      this.toolbar.addHandler('emoji', this.checkPalatteExist)\r\n    }\r\n\r\n    // 在emoji模块加载时判断并插入emoji精灵图样式，防止重复插入\r\n    let emojiStyle = document.querySelector('style#devui-emoji-sprite')\r\n    if (!emojiStyle) {\r\n      emojiStyle = document.createElement('style')\r\n      emojiStyle.setAttribute('id', 'devui-emoji-sprite')\r\n      emojiStyle.innerHTML = `.ap{background-image:url(${emojiSprite})}`\r\n      document.head.appendChild(emojiStyle)\r\n    }\r\n  }\r\n\r\n  checkPalatteExist() {\r\n    const quill = this.quill\r\n    fnCheckDialogOpen(quill)\r\n    this.quill.on('text-change', (_delta, _oldDelta, source) => {\r\n      if (source === 'user') {\r\n        fnClose()\r\n        fnUpdateRange(quill)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction fnClose() {\r\n  const eleEmojiPlate = document.getElementById('emoji-palette')\r\n  document.getElementById('emoji-close-div').style.display = 'none'\r\n  if (eleEmojiPlate) {\r\n    eleEmojiPlate.remove()\r\n  }\r\n}\r\n\r\nfunction fnCheckDialogOpen(quill) {\r\n  const elementExists = document.getElementById('emoji-palette')\r\n  if (elementExists) {\r\n    elementExists.remove()\r\n  }\r\n  else {\r\n    fnShowEmojiPalatte(quill)\r\n  }\r\n}\r\n\r\nfunction fnUpdateRange(quill) {\r\n  const range = quill.getSelection()\r\n  return range\r\n}\r\n\r\nfunction fnShowEmojiPalatte(quill) {\r\n  const eleEmojiArea = document.createElement('div')\r\n  const range = quill.getSelection()\r\n  const atSignBounds = quill.getBounds(range.index)\r\n\r\n  quill.container.appendChild(eleEmojiArea)\r\n  const containerRect = quill.container.getBoundingClientRect()\r\n  const paletteMaxPos = atSignBounds.left + 250 // palette max width is 250\r\n  eleEmojiArea.id = 'emoji-palette'\r\n  eleEmojiArea.style.top = `${10 + atSignBounds.top + atSignBounds.height + containerRect.top}px`\r\n  if (paletteMaxPos > quill.container.offsetWidth) {\r\n    eleEmojiArea.style.left = `${atSignBounds.left + containerRect.left - 250}px`\r\n  }\r\n  else {\r\n    eleEmojiArea.style.left = `${atSignBounds.left + containerRect.left}px`\r\n  }\r\n\r\n  const tabToolbar = document.createElement('div')\r\n  tabToolbar.id = 'tab-toolbar'\r\n  eleEmojiArea.appendChild(tabToolbar)\r\n\r\n  // panel\r\n  const panel = document.createElement('div')\r\n  panel.id = 'tab-panel'\r\n  eleEmojiArea.appendChild(panel)\r\n\r\n  const emojiType = [\r\n    { type: 'p', name: 'people', content: '<div class=\"i-people\"></div>' },\r\n    { type: 'n', name: 'nature', content: '<div class=\"i-nature\"></div>' },\r\n    { type: 'd', name: 'food', content: '<div class=\"i-food\"></div>' },\r\n    { type: 's', name: 'symbols', content: '<div class=\"i-symbols\"></div>' },\r\n    { type: 'a', name: 'activity', content: '<div class=\"i-activity\"></div>' },\r\n    { type: 't', name: 'travel', content: '<div class=\"i-travel\"></div>' },\r\n    { type: 'o', name: 'objects', content: '<div class=\"i-objects\"></div>' },\r\n    { type: 'f', name: 'flags', content: '<div class=\"i-flags\"></div>' },\r\n  ]\r\n\r\n  const tabElementHolder = document.createElement('ul')\r\n  tabToolbar.appendChild(tabElementHolder)\r\n\r\n  if (document.getElementById('emoji-close-div') === null) {\r\n    const closeDiv = document.createElement('div')\r\n    closeDiv.id = 'emoji-close-div'\r\n    closeDiv.addEventListener('click', fnClose, false)\r\n    document.getElementsByTagName('body')[0].appendChild(closeDiv)\r\n  }\r\n  else {\r\n    document.getElementById('emoji-close-div').style.display = 'block'\r\n  }\r\n\r\n  emojiType.forEach((emojiTypeItem) => {\r\n    // add tab bar\r\n    const tabElement = document.createElement('li')\r\n    tabElement.classList.add('emoji-tab')\r\n    tabElement.classList.add(`filter-${emojiTypeItem.name}`)\r\n    const tabValue = emojiTypeItem.content\r\n    tabElement.innerHTML = tabValue\r\n    tabElement.dataset.filter = emojiTypeItem.type\r\n    tabElementHolder.appendChild(tabElement)\r\n\r\n    const emojiFilter = document.querySelector(`.filter-${emojiTypeItem.name}`)\r\n    emojiFilter.addEventListener('click', () => {\r\n      const tab = document.querySelector('.emoji-tab.active')\r\n      if (tab) {\r\n        tab.classList.remove('active')\r\n      }\r\n      emojiFilter.classList.toggle('active')\r\n      fnUpdateEmojiContainer(emojiFilter, panel, quill)\r\n    })\r\n  })\r\n  fnEmojiPanelInit(panel, quill)\r\n}\r\n\r\nfunction fnEmojiPanelInit(panel, quill) {\r\n  fnEmojiElementsToPanel('p', panel, quill)\r\n  document.querySelector('.filter-people').classList.add('active')\r\n}\r\n\r\nfunction fnEmojiElementsToPanel(_type, panel, quill) {\r\n  const result = emojiList\r\n  result.sort((a: any, b: any) => {\r\n    return a.emoji_order - b.emoji_order\r\n  })\r\n\r\n  quill.focus()\r\n  const range = fnUpdateRange(quill)\r\n\r\n  result.forEach((emoji: any) => {\r\n    const span = document.createElement('span')\r\n    const t = document.createTextNode(emoji.shortname)\r\n    span.appendChild(t)\r\n    span.classList.add('bem')\r\n    span.classList.add(`bem-${emoji.name}`)\r\n    span.classList.add('ap')\r\n    span.classList.add(`ap-${emoji.name}`)\r\n    const output = String(String(emoji.code_decimal))\r\n    span.innerHTML = `${output} `\r\n    panel.appendChild(span)\r\n\r\n    const customButton = document.querySelector(`.bem-${emoji.name}`)\r\n    if (customButton) {\r\n      customButton.addEventListener('click', () => {\r\n        quill.insertEmbed(range.index, 'emoji', emoji, Quill.sources.USER)\r\n        setTimeout(() => quill.setSelection(range.index + 1), 0)\r\n        fnClose()\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nfunction fnUpdateEmojiContainer(emojiFilter, panel, quill) {\r\n  while (panel.firstChild) {\r\n    panel.removeChild(panel.firstChild)\r\n  }\r\n  const type = emojiFilter.dataset.filter\r\n  fnEmojiElementsToPanel(type, panel, quill)\r\n}\r\n\r\nexport default ToolbarEmoji\r\n"],"names":["emojiSprite"],"mappings":"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"}