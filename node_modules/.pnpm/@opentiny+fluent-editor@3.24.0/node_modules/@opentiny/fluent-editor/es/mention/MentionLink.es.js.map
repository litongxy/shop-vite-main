{"version":3,"file":"MentionLink.es.js","sources":["../../../src/mention/MentionLink.ts"],"sourcesContent":["import type TypeEmbed from 'quill/blots/embed'\r\nimport Quill from 'quill'\r\nimport { DEFAULT_MENTION_CHAR, MENTION_CHAR, ON_MENTION_LINK_REMOVE } from './constants'\r\n\r\nconst Embed = Quill.import('blots/embed') as typeof TypeEmbed\r\n\r\n// @dynamic\r\nclass MentionLink extends Embed {\r\n  static blotName: string\r\n  static tagName: string\r\n  static className: string\r\n  scroll: any\r\n  mentionData: any\r\n\r\n  static create(data) {\r\n    let node: HTMLElement\r\n    if (data.link) {\r\n      node = document.createElement('a')\r\n      node.setAttribute('href', data.link)\r\n      node.setAttribute('target', data.target)\r\n    }\r\n    else {\r\n      node = document.createElement(this.tagName)\r\n    }\r\n    node.classList.add(this.className)\r\n    node.dataset.mentionId = data.name || (data.mention && data.mention[data.searchKey || 'name']) || ''\r\n    node.setAttribute('title', data.text)\r\n    node.setAttribute(MENTION_CHAR, data.char)\r\n    node.textContent = data.char + data.text\r\n    return node\r\n  }\r\n\r\n  static value(domNode: HTMLElement) {\r\n    const value: Record<string, any> = {\r\n      char: domNode.getAttribute(MENTION_CHAR) || DEFAULT_MENTION_CHAR,\r\n      text: domNode.getAttribute('title'),\r\n      name: domNode.dataset.mentionId,\r\n    }\r\n    if (domNode.tagName.toLowerCase() === 'a' && domNode.hasAttribute('href')) {\r\n      value.link = domNode.getAttribute('href')\r\n      value.target = domNode.getAttribute('target')\r\n    }\r\n    return value\r\n  }\r\n\r\n  constructor(scroll, domNode, data) {\r\n    super(scroll, domNode)\r\n    this.mentionData = data\r\n  }\r\n\r\n  value() {\r\n    // fix: 将@提醒内容加入到 Delta 里，以解决输入空格，@提醒内容被删除的问题\r\n    // return ' ';\r\n    return super.value()\r\n  }\r\n\r\n  remove() {\r\n    this.scroll.emitter.emit(ON_MENTION_LINK_REMOVE, this.mentionData)\r\n    return super.remove()\r\n  }\r\n}\r\n\r\nMentionLink.blotName = 'mention'\r\nMentionLink.tagName = 'span'\r\nMentionLink.className = 'ql-mention-link'\r\nexport { MentionLink as default }\r\n"],"names":[],"mappings":";;AAIA,MAAM,QAAQ,MAAM,OAAO,aAAa;AAGxC,MAAM,oBAAoB,MAAM;AAAA,EAO9B,OAAO,OAAO,MAAM;AACd,QAAA;AACJ,QAAI,KAAK,MAAM;AACN,aAAA,SAAS,cAAc,GAAG;AAC5B,WAAA,aAAa,QAAQ,KAAK,IAAI;AAC9B,WAAA,aAAa,UAAU,KAAK,MAAM;AAAA,IAAA,OAEpC;AACI,aAAA,SAAS,cAAc,KAAK,OAAO;AAAA,IAC5C;AACK,SAAA,UAAU,IAAI,KAAK,SAAS;AAC5B,SAAA,QAAQ,YAAY,KAAK,QAAS,KAAK,WAAW,KAAK,QAAQ,KAAK,aAAa,MAAM,KAAM;AAC7F,SAAA,aAAa,SAAS,KAAK,IAAI;AAC/B,SAAA,aAAa,cAAc,KAAK,IAAI;AACpC,SAAA,cAAc,KAAK,OAAO,KAAK;AAC7B,WAAA;AAAA,EACT;AAAA,EAEA,OAAO,MAAM,SAAsB;AACjC,UAAM,QAA6B;AAAA,MACjC,MAAM,QAAQ,aAAa,YAAY,KAAK;AAAA,MAC5C,MAAM,QAAQ,aAAa,OAAO;AAAA,MAClC,MAAM,QAAQ,QAAQ;AAAA,IAAA;AAEpB,QAAA,QAAQ,QAAQ,YAAY,MAAM,OAAO,QAAQ,aAAa,MAAM,GAAG;AACnE,YAAA,OAAO,QAAQ,aAAa,MAAM;AAClC,YAAA,SAAS,QAAQ,aAAa,QAAQ;AAAA,IAC9C;AACO,WAAA;AAAA,EACT;AAAA,EAEA,YAAY,QAAQ,SAAS,MAAM;AACjC,UAAM,QAAQ,OAAO;AACrB,SAAK,cAAc;AAAA,EACrB;AAAA,EAEA,QAAQ;AAGN,WAAO,MAAM;EACf;AAAA,EAEA,SAAS;AACP,SAAK,OAAO,QAAQ,KAAK,wBAAwB,KAAK,WAAW;AACjE,WAAO,MAAM;EACf;AACF;AAEA,YAAY,WAAW;AACvB,YAAY,UAAU;AACtB,YAAY,YAAY;"}