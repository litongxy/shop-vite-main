{"version":3,"file":"file.es.js","sources":["../../../../src/file/formats/file.ts"],"sourcesContent":["import Quill from 'quill'\r\nimport { sanitize } from '../../config/editor.utils'\r\n\r\nconst Embed = Quill.imports['blots/embed']\r\nconst FILE_ATTRIBUTES = ['id', 'title', 'size', 'lastModified']\r\n\r\nclass File extends Embed {\r\n  static blotName: string\r\n  static tagName: string\r\n  static className: string\r\n  static PROTOCOL_WHITELIST: string[]\r\n  statics: any\r\n  domNode: any\r\n\r\n  static create(value) {\r\n    const node = super.create(value)\r\n    const size = value.size / 1024\r\n    const fixSize = !size ? 0 : size < 1 ? 1 : size.toFixed(0)\r\n    node.classList.add('icon-file')\r\n    node.setAttribute('contenteditable', false)\r\n    const fileSvg = '<svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\"><path d=\"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326z m1.8 562H232V136h302v216c0 23.2 18.8 42 42 42h216v494z\" p-id=\"2307\"></path></svg>'\r\n    node.innerHTML = `${fileSvg} ${value.title} (${fixSize} KB)`\r\n    const src = File.sanitize(value.src)\r\n    if (src) {\r\n      node.href = src\r\n      node.target = '_blank'\r\n    }\r\n    FILE_ATTRIBUTES.forEach((key) => {\r\n      if (value[key]) {\r\n        node.dataset[key] = value[key]\r\n      }\r\n    })\r\n    return node\r\n  }\r\n\r\n  static value(domNode) {\r\n    return File.getFormats(domNode)\r\n  }\r\n\r\n  static formats(domNode) {\r\n    return File.getFormats(domNode)\r\n  }\r\n\r\n  static getFormats(domNode) {\r\n    const formats: any = {}\r\n    const href = File.sanitize(domNode.href)\r\n    if (href) {\r\n      formats.src = href\r\n    }\r\n    FILE_ATTRIBUTES.forEach((key) => {\r\n      if (domNode.dataset[key]) {\r\n        formats[key] = domNode.dataset[key]\r\n      }\r\n    })\r\n    return formats\r\n  }\r\n\r\n  static sanitize(url) {\r\n    return (sanitize(url, this.PROTOCOL_WHITELIST) && url) || ''\r\n  }\r\n}\r\nFile.blotName = 'file'\r\nFile.tagName = 'A'\r\nFile.className = 'ql-file-item'\r\nFile.PROTOCOL_WHITELIST = ['http', 'https']\r\n\r\nexport default File\r\n"],"names":[],"mappings":";;AAGA,MAAM,QAAQ,MAAM,QAAQ,aAAa;AACzC,MAAM,kBAAkB,CAAC,MAAM,SAAS,QAAQ,cAAc;AAE9D,MAAM,aAAa,MAAM;AAAA,EAQvB,OAAO,OAAO,OAAO;AACb,UAAA,OAAO,MAAM,OAAO,KAAK;AACzB,UAAA,OAAO,MAAM,OAAO;AACpB,UAAA,UAAU,CAAC,OAAO,IAAI,OAAO,IAAI,IAAI,KAAK,QAAQ,CAAC;AACpD,SAAA,UAAU,IAAI,WAAW;AACzB,SAAA,aAAa,mBAAmB,KAAK;AAC1C,UAAM,UAAU;AAChB,SAAK,YAAY,GAAG,OAAO,IAAI,MAAM,KAAK,KAAK,OAAO;AACtD,UAAM,MAAM,KAAK,SAAS,MAAM,GAAG;AACnC,QAAI,KAAK;AACP,WAAK,OAAO;AACZ,WAAK,SAAS;AAAA,IAChB;AACgB,oBAAA,QAAQ,CAAC,QAAQ;AAC3B,UAAA,MAAM,GAAG,GAAG;AACd,aAAK,QAAQ,GAAG,IAAI,MAAM,GAAG;AAAA,MAC/B;AAAA,IAAA,CACD;AACM,WAAA;AAAA,EACT;AAAA,EAEA,OAAO,MAAM,SAAS;AACb,WAAA,KAAK,WAAW,OAAO;AAAA,EAChC;AAAA,EAEA,OAAO,QAAQ,SAAS;AACf,WAAA,KAAK,WAAW,OAAO;AAAA,EAChC;AAAA,EAEA,OAAO,WAAW,SAAS;AACzB,UAAM,UAAe,CAAA;AACrB,UAAM,OAAO,KAAK,SAAS,QAAQ,IAAI;AACvC,QAAI,MAAM;AACR,cAAQ,MAAM;AAAA,IAChB;AACgB,oBAAA,QAAQ,CAAC,QAAQ;AAC3B,UAAA,QAAQ,QAAQ,GAAG,GAAG;AACxB,gBAAQ,GAAG,IAAI,QAAQ,QAAQ,GAAG;AAAA,MACpC;AAAA,IAAA,CACD;AACM,WAAA;AAAA,EACT;AAAA,EAEA,OAAO,SAAS,KAAK;AACnB,WAAQ,SAAS,KAAK,KAAK,kBAAkB,KAAK,OAAQ;AAAA,EAC5D;AACF;AACA,KAAK,WAAW;AAChB,KAAK,UAAU;AACf,KAAK,YAAY;AACjB,KAAK,qBAAqB,CAAC,QAAQ,OAAO;"}