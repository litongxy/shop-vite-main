{"version":3,"file":"debounce.es.js","sources":["../../../src/utils/debounce.ts"],"sourcesContent":["import { isObject } from './is'\r\nimport { root } from './method'\r\n\r\nexport function debounce(func, wait, options = undefined) {\r\n  let lastArgs,\r\n    lastThis,\r\n    maxWait,\r\n    result,\r\n    timerId,\r\n    lastCallTime\r\n\r\n  let lastInvokeTime = 0\r\n  let leading = false\r\n  let maxing = false\r\n  let trailing = true\r\n\r\n  // Bypass `requestAnimationFrame` by explicitly setting `wait=0`.\r\n  const useRAF = (!wait && wait !== 0 && typeof root.requestAnimationFrame === 'function')\r\n\r\n  if (typeof func !== 'function') {\r\n    throw new TypeError('Expected a function')\r\n  }\r\n  wait = +wait || 0\r\n  if (isObject(options)) {\r\n    leading = !!options.leading\r\n    maxing = 'maxWait' in options\r\n    maxWait = maxing ? Math.max(+options.maxWait || 0, wait) : maxWait\r\n    trailing = 'trailing' in options ? !!options.trailing : trailing\r\n  }\r\n\r\n  function invokeFunc(time) {\r\n    const args = lastArgs\r\n    const thisArg = lastThis\r\n\r\n    lastArgs = lastThis = undefined\r\n    lastInvokeTime = time\r\n    result = func.apply(thisArg, args)\r\n    return result\r\n  }\r\n\r\n  function startTimer(pendingFunc, wait) {\r\n    if (useRAF) {\r\n      root.cancelAnimationFrame(timerId)\r\n      return root.requestAnimationFrame(pendingFunc)\r\n    }\r\n    return setTimeout(pendingFunc, wait)\r\n  }\r\n\r\n  function cancelTimer(id) {\r\n    if (useRAF) {\r\n      return root.cancelAnimationFrame(id)\r\n    }\r\n    clearTimeout(id)\r\n  }\r\n\r\n  function leadingEdge(time) {\r\n    // Reset any `maxWait` timer.\r\n    lastInvokeTime = time\r\n    // Start the timer for the trailing edge.\r\n    timerId = startTimer(timerExpired, wait)\r\n    // Invoke the leading edge.\r\n    return leading ? invokeFunc(time) : result\r\n  }\r\n\r\n  function remainingWait(time) {\r\n    const timeSinceLastCall = time - lastCallTime\r\n    const timeSinceLastInvoke = time - lastInvokeTime\r\n    const timeWaiting = wait - timeSinceLastCall\r\n\r\n    return maxing\r\n      ? Math.min(timeWaiting, maxWait - timeSinceLastInvoke)\r\n      : timeWaiting\r\n  }\r\n\r\n  function shouldInvoke(time) {\r\n    const timeSinceLastCall = time - lastCallTime\r\n    const timeSinceLastInvoke = time - lastInvokeTime\r\n\r\n    // Either this is the first call, activity has stopped and we're at the\r\n    // trailing edge, the system time has gone backwards and we're treating\r\n    // it as the trailing edge, or we've hit the `maxWait` limit.\r\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait)\r\n      || (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait))\r\n  }\r\n\r\n  function timerExpired() {\r\n    const time = Date.now()\r\n    if (shouldInvoke(time)) {\r\n      return trailingEdge(time)\r\n    }\r\n    // Restart the timer.\r\n    timerId = startTimer(timerExpired, remainingWait(time))\r\n  }\r\n\r\n  function trailingEdge(time) {\r\n    timerId = undefined\r\n\r\n    // Only invoke if we have `lastArgs` which means `func` has been\r\n    // debounced at least once.\r\n    if (trailing && lastArgs) {\r\n      return invokeFunc(time)\r\n    }\r\n    lastArgs = lastThis = undefined\r\n    return result\r\n  }\r\n\r\n  function cancel() {\r\n    if (timerId !== undefined) {\r\n      cancelTimer(timerId)\r\n    }\r\n    lastInvokeTime = 0\r\n    lastArgs = lastCallTime = lastThis = timerId = undefined\r\n  }\r\n\r\n  function flush() {\r\n    return timerId === undefined ? result : trailingEdge(Date.now())\r\n  }\r\n\r\n  function pending() {\r\n    return timerId !== undefined\r\n  }\r\n\r\n  function debounced(...args) {\r\n    const time = Date.now()\r\n    const isInvoking = shouldInvoke(time)\r\n\r\n    lastArgs = args\r\n    lastThis = this\r\n    lastCallTime = time\r\n\r\n    if (isInvoking) {\r\n      if (timerId === undefined) {\r\n        return leadingEdge(lastCallTime)\r\n      }\r\n      if (maxing) {\r\n        // Handle invocations in a tight loop.\r\n        timerId = startTimer(timerExpired, wait)\r\n        return invokeFunc(lastCallTime)\r\n      }\r\n    }\r\n    if (timerId === undefined) {\r\n      timerId = startTimer(timerExpired, wait)\r\n    }\r\n    return result\r\n  }\r\n  debounced.cancel = cancel\r\n  debounced.flush = flush\r\n  debounced.pending = pending\r\n  return debounced\r\n}\r\n"],"names":["wait"],"mappings":"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"}