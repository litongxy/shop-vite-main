{"version":3,"file":"table-selector.es.js","sources":["../../../../src/table/modules/table-selector.ts"],"sourcesContent":["import { css } from '../utils'\r\n\r\n// 配置\r\nconst GRID_SIZE = {\r\n  ROWS: 10,\r\n  COLS: 10,\r\n  CELL_SIZE: 15,\r\n}\r\n\r\nconst STYLES = {\r\n  container: {\r\n    'position': 'absolute',\r\n    'z-index': '1000',\r\n    'background': 'white',\r\n    'border': '1px solid #ccc',\r\n    'padding': '5px',\r\n    'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\r\n  },\r\n  grid: {\r\n    'display': 'grid',\r\n    'grid-template-columns': `repeat(${GRID_SIZE.COLS}, ${GRID_SIZE.CELL_SIZE - 1}px)`,\r\n    'grid-template-rows': `repeat(${GRID_SIZE.ROWS}, ${GRID_SIZE.CELL_SIZE - 1}px)`,\r\n    'gap': '0px',\r\n  },\r\n  row: {\r\n    display: 'contents',\r\n  },\r\n  cell: {\r\n    'width': `${GRID_SIZE.CELL_SIZE}px`,\r\n    'height': `${GRID_SIZE.CELL_SIZE}px`,\r\n    'border': '1px solid #ddd',\r\n    'background-color': '#fff',\r\n    'box-sizing': 'border-box',\r\n  },\r\n  label: {\r\n    'text-align': 'center',\r\n    'margin-top': '5px',\r\n    'font-size': '12px',\r\n    'color': '#666',\r\n  },\r\n}\r\n\r\nfunction createCell(\r\n  row: number,\r\n  col: number,\r\n  handleMouseOver: (row: number, col: number) => void,\r\n  handleClick: () => void,\r\n): { cellDiv: HTMLDivElement, removeListeners: () => void } {\r\n  const cellDiv = document.createElement('div')\r\n  cellDiv.className = 'cell'\r\n  css(cellDiv, STYLES.cell)\r\n\r\n  const mouseOverListener = () => handleMouseOver(row + 1, col + 1)\r\n  const clickListener = () => handleClick()\r\n\r\n  cellDiv.addEventListener('mouseover', mouseOverListener)\r\n  cellDiv.addEventListener('click', clickListener)\r\n\r\n  const removeListeners = () => {\r\n    cellDiv.removeEventListener('mouseover', mouseOverListener)\r\n    cellDiv.removeEventListener('click', clickListener)\r\n  }\r\n\r\n  return { cellDiv, removeListeners }\r\n}\r\n\r\nfunction createRow(\r\n  rowIndex: number,\r\n  handleMouseOver: (row: number, col: number) => void,\r\n  handleClick: () => void,\r\n): { rowDiv: HTMLDivElement, removeListeners: () => void } {\r\n  const rowDiv = document.createElement('div')\r\n  rowDiv.className = 'row'\r\n  css(rowDiv, STYLES.row)\r\n\r\n  const fragment = document.createDocumentFragment()\r\n  const removeListenersArray: (() => void)[] = []\r\n\r\n  for (let col = 0; col < GRID_SIZE.COLS; col++) {\r\n    const { cellDiv, removeListeners } = createCell(rowIndex, col, handleMouseOver, handleClick)\r\n    fragment.appendChild(cellDiv)\r\n    removeListenersArray.push(removeListeners)\r\n  }\r\n\r\n  rowDiv.appendChild(fragment)\r\n\r\n  const removeListeners = () => {\r\n    removeListenersArray.forEach(remove => remove())\r\n  }\r\n\r\n  return { rowDiv, removeListeners }\r\n}\r\n\r\nclass TableSelector {\r\n  private onSelect: (rows: number, cols: number) => void\r\n  container: HTMLDivElement\r\n  private grid: HTMLDivElement\r\n  private label: HTMLDivElement\r\n  private rows: number = 0\r\n  private cols: number = 0\r\n  private removeListenersArray: (() => void)[] = []\r\n\r\n  constructor({ onSelect }: { onSelect: (rows: number, cols: number) => void }) {\r\n    this.onSelect = onSelect\r\n    this.initContainer()\r\n    this.initGrid()\r\n    this.initLabel()\r\n  }\r\n\r\n  // init table-selector container\r\n  private initContainer() {\r\n    this.container = document.createElement('div')\r\n    this.container.className = 'table-selector'\r\n    css(this.container, STYLES.container)\r\n  }\r\n\r\n  // init grid\r\n  private initGrid() {\r\n    this.grid = document.createElement('div')\r\n    this.grid.className = 'grid'\r\n    css(this.grid, STYLES.grid)\r\n\r\n    const fragment = document.createDocumentFragment()\r\n\r\n    for (let row = 0; row < GRID_SIZE.ROWS; row++) {\r\n      const { rowDiv, removeListeners } = createRow(\r\n        row,\r\n        this.handleMouseOver.bind(this),\r\n        this.handleClick.bind(this),\r\n      )\r\n      fragment.appendChild(rowDiv)\r\n      this.removeListenersArray.push(removeListeners)\r\n    }\r\n    this.grid.appendChild(fragment)\r\n    this.container.appendChild(this.grid)\r\n  }\r\n\r\n  // init label\r\n  private initLabel() {\r\n    this.label = document.createElement('div')\r\n    this.label.className = 'label'\r\n    css(this.label, STYLES.label)\r\n    this.container.appendChild(this.label)\r\n  }\r\n\r\n  private handleMouseOver(row: number, col: number) {\r\n    this.rows = row\r\n    this.cols = col\r\n    this.updateGrid()\r\n  }\r\n\r\n  private handleClick() {\r\n    this.onSelect(this.rows, this.cols)\r\n    this.hide()\r\n  }\r\n\r\n  updateGrid() {\r\n    const cells = this.grid.getElementsByClassName('cell')\r\n    for (let i = 0; i < cells.length; i++) {\r\n      const cell = cells[i] as HTMLElement\r\n      const row = Math.floor(i / GRID_SIZE.COLS)\r\n      const col = i % GRID_SIZE.COLS\r\n      css(cell, {\r\n        'background-color': row < this.rows && col < this.cols ? '#e6f3ff' : '#fff',\r\n      })\r\n    }\r\n    this.label.textContent = `${this.rows} x ${this.cols}`\r\n  }\r\n\r\n  show(x: number, y: number) {\r\n    css(this.container, {\r\n      'left': `${x}px`,\r\n      'top': `${y}px`,\r\n      'display': 'block',\r\n      'margin-top': '1px',\r\n    })\r\n  }\r\n\r\n  hide() {\r\n    css(this.container, { display: 'none' })\r\n  }\r\n\r\n  destroy() {\r\n    this.removeListenersArray.forEach(remove => remove())\r\n    this.removeListenersArray = []\r\n\r\n    this.hide()\r\n    if (this.container.parentNode) {\r\n      this.container.parentNode.removeChild(this.container)\r\n    }\r\n    this.rows = 0\r\n    this.cols = 0\r\n    return null\r\n  }\r\n}\r\n\r\nexport default TableSelector\r\n"],"names":["removeListeners"],"mappings":"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"}