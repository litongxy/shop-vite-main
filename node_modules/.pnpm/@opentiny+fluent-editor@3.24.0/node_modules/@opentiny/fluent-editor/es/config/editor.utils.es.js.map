{"version":3,"file":"editor.utils.es.js","sources":["../../../src/config/editor.utils.ts"],"sourcesContent":["import Quill from 'quill'\r\n\r\nconst Delta = Quill.import('delta')\r\n\r\n// color hex to rgba\r\nexport function hexToRgbA(hex: string) {\r\n  let color\r\n  if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\r\n    color = hex.substring(1).split('')\r\n    if (color.length === 3) {\r\n      color = [color[0], color[0], color[1], color[1], color[2], color[2]]\r\n    }\r\n    color = `0x${color.join('')}`\r\n    return (\r\n      `rgba(${\r\n        [(color >> 16) & 255, (color >> 8) & 255, color & 255].join(',')\r\n      },1)`\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * 将File格式的图片转换成Url格式\r\n * @param imageFile File格式的图片\r\n */\r\nexport function imageFileToUrl(imageFile) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n    reader.readAsDataURL(imageFile)\r\n    reader.onload = function (e) {\r\n      resolve(e.target.result)\r\n    }\r\n    reader.onerror = reject\r\n  }).catch((error) => {\r\n    console.error('Error reading file:', error)\r\n  })\r\n}\r\n\r\n/**\r\n * 将Url格式的图片转换成File格式\r\n * @param imageUrl 图片的URL\r\n */\r\nexport function imageUrlToFile(imageUrl, isErrorImage?: boolean) {\r\n  return new Promise((resolve, reject) => {\r\n    fetch(imageUrl, {\r\n      method: 'get',\r\n      mode: 'no-cors',\r\n    })\r\n      .then(res => res.blob())\r\n      .then((blob) => {\r\n        if (!blob.type.includes('image') || !blob.type) {\r\n          return reject()\r\n        }\r\n        const fileType = blob.type.replace(/^.*\\//, '')\r\n        const fileName = isErrorImage\r\n          ? 'editorx-error-image.png'\r\n          : `image-${new Date().getTime()}.${fileType}`\r\n        const file = new File([blob], fileName, blob)\r\n        resolve(file)\r\n      })\r\n      .catch(reject)\r\n  })\r\n}\r\n\r\nexport function insideTable(range = null, quill = this.quill) {\r\n  let currentRange = range\r\n  if (!currentRange) {\r\n    currentRange = quill.getSelection()\r\n  }\r\n  // fix: 原有formats方法无法判断表格内的list和head附近粘贴\r\n  const [line] = quill.getLine(currentRange.index)\r\n  return line && !!line.domNode.closest('table.quill-better-table')\r\n}\r\n\r\nexport function isNullOrUndefined(param) {\r\n  return param === null || param === undefined\r\n}\r\n\r\n/**\r\n * omit\r\n * @param   obj         target Object\r\n * @param   uselessKeys  keys of removed properties\r\n * @return             new Object without useless properties\r\n */\r\nexport function omit(obj, uselessKeys) {\r\n  return (\r\n    obj\r\n    && Object.keys(obj).reduce((acc, key) => {\r\n      return uselessKeys.includes(key) ? acc : { ...acc, [key]: obj[key] }\r\n    }, {})\r\n  )\r\n}\r\n\r\n/**\r\n * 将delta中的图片替换成制定的图片数组，用于图片上传到服务器的场景\r\n * @param delta 原始delta\r\n * @param imageUrls 图片数组\r\n * @param imagePlaceholder 标识是否是占位图的数组，与图片数组一一对应\r\n * @return 替换之后的delta\r\n */\r\nexport function replaceDeltaImage(delta, imageUrls, imagePlaceholder) {\r\n  let imageIndex = 0\r\n  return delta.reduce((newDelta, op) => {\r\n    if (op.insert.image && !op.insert.image.hasExisted) {\r\n      const attributes = imagePlaceholder[imageIndex]\r\n        ? { ...op.attributes, width: 'auto', height: 225 } // 占位图片应该固定大小\r\n        : op.attributes\r\n      newDelta.insert({ image: imageUrls[imageIndex] }, attributes)\r\n      imageIndex++\r\n    }\r\n    else {\r\n      newDelta.insert(op.insert, op.attributes)\r\n    }\r\n    return newDelta\r\n  }, new Delta())\r\n}\r\n\r\nexport function splitWithBreak(insertContent: string) {\r\n  const lines = []\r\n  const insertStr = insertContent\r\n  let start = 0\r\n  for (let i = 0; i < insertContent.length; i++) {\r\n    if (insertStr.charAt(i) === '\\n') {\r\n      if (i === 0) {\r\n        lines.push('\\n')\r\n      }\r\n      else {\r\n        lines.push(insertStr.substring(start, i))\r\n        lines.push('\\n')\r\n      }\r\n      start = i + 1\r\n    }\r\n  }\r\n\r\n  const tailStr = insertStr.substring(start)\r\n  if (tailStr) {\r\n    lines.push(tailStr)\r\n  }\r\n\r\n  return lines\r\n}\r\n\r\n/**\r\n * getEventComposedPath\r\n *  compatibility fixed for Event.path/Event.composedPath\r\n *  Event.path is only for chrome/opera\r\n *  Event.composedPath is for Safari, FF\r\n *  Neither for Micro Edge\r\n * @return an array of event.path\r\n */\r\nexport function getEventComposedPath(evt) {\r\n  let path\r\n  // chrome, opera, safari, firefox\r\n  path = evt.path || (evt.composedPath && evt.composedPath())\r\n\r\n  // other: edge\r\n  if (path === undefined && evt.target) {\r\n    path = []\r\n    let target = evt.target\r\n    path.push(target)\r\n\r\n    while (target && target.parentNode) {\r\n      target = target.parentNode\r\n      path.push(target)\r\n    }\r\n  }\r\n\r\n  return path\r\n}\r\n\r\nexport function sanitize(url, protocols) {\r\n  const anchor = document.createElement('a')\r\n  anchor.href = url\r\n  const protocol = anchor.href.slice(0, anchor.href.indexOf(':'))\r\n  return protocols.includes(protocol)\r\n}\r\n\r\nexport function hadProtocol(url: string) {\r\n  if (!url || !/^(?:f|ht)tps?\\:\\/\\//.test(url)) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function isInside(position, dom) {\r\n  const areaPosition = dom.getBoundingClientRect()\r\n  const { pageX, pageY } = position\r\n  // getBoundingClientRect是不考虑窗口滚动的\r\n  const left = pageX - window.scrollX\r\n  const top = pageY - window.scrollY\r\n  const {\r\n    left: areaLeft,\r\n    top: areaTop,\r\n    width: areaWidth,\r\n    height: areaHeight,\r\n  } = areaPosition\r\n  const inside\r\n    = left > areaLeft\r\n    && left < areaLeft + areaWidth\r\n    && top > areaTop\r\n    && top < areaTop + areaHeight\r\n  return inside\r\n}\r\n\r\n// Internet Explorer 6-11\r\nexport const isPureIE = !!document.documentMode\r\n"],"names":[],"mappings":"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"}